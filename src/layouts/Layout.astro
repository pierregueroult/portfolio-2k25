---
import { ClientRouter } from "astro:transitions";
import Header from "@/components/Header.astro";
import PostHog from "@/components/PostHog.astro";
import { LOCALES, SITE } from "@/consts";
import { getDir, getLocale } from "@/utils/get-locale";
import { removeTrailingSlash } from "@/utils/remove-trailing-slash";

import "../styles/global.css";

interface Props {
  title: string;
  description: string;
  keywords?: string[];
}
const { title, description, keywords } = Astro.props;
const { theme } = Astro.locals;

const defaultKeywords: string[] = [
  "web development",
  "frontend developer",
  "backend developer",
  "full-stack projects",
  "Astro framework",
  "JavaScript",
  "Typescript",
  "php",
  "Tailwind CSS",
  "GitHub portfolio",
  "Pierre Guéroult",
];

// TODO: Handle alternate, canonical, and hreflang

const ogImage = ["home", "projects", "blog", "socials"].find((image) => Astro.originPathname.includes(image)) || "home";
---

<!doctype html>
<html lang={getLocale(Astro.params.lang)} dir={getDir(Astro.params.lang)}>
  <head>
    <title>Pierre Guéroult - {title}</title>
    <meta charset="utf-8" />
    <meta name="author" content="Pierre Guéroult" />
    <meta name="description" content={description} />
    <meta name="generator" content={Astro.generator} />
    <meta name="viewport" content="width=device-width" />
    <meta
      name="keywords"
      content={keywords ? [...keywords, ...defaultKeywords].join(", ") : defaultKeywords.join(", ")}
    />
    <meta property="og:title" content={`Pierre Guéroult - ${title}`} />
    <meta property="og:type" content="website" />
    <meta property="og:description" content={description} />
    <meta property="og:image" content={`${SITE}/open-graph/banner-${ogImage}.png`} />
    <meta property="og:site_name" content="Pierre Guéroult" />
    <meta property="og:locale" content={getLocale(Astro.params.lang)} />
    <meta property="twitter:card" content="summary_large_image" />
    <meta property="twitter:title" content={`Pierre Guéroult - ${title}`} />
    <meta property="twitter:description" content={description} />
    <meta property="twitter:image" content={`${SITE}/open-graph/banner-${ogImage}.png`} />
    <meta property="twitter:site" content="@pierregueroult1" />
    <meta property="twitter:creator" content="@pierregueroult1" />
    <meta name="robots" content="index, follow" />
    <link rel="sitemap" href="/sitemap-index.xml" />
    <link rel="icon" type="image/svg+xml" href="/favicon.svg" />
    <link rel="preconnect" href="https://eu.i.posthog.com" crossorigin="anonymous" />
    <link rel="preconnect" href="https://eu-assets.i.posthog.com" crossorigin="anonymous" />
    {
      LOCALES.map((locale) => {
        const href = removeTrailingSlash(`/${locale}${Astro.originPathname.replace(`/${Astro.params.lang}`, "")}`);
        return (
          <>
            <link rel="alternate" hreflang={locale} {href} />
            {locale === "fr" && <link rel="alternate" hreflang="x-default" {href} />}
          </>
        );
      })
    }
    <ClientRouter />
  </head>
  <body class="font-mono bg-background text-foreground" data-theme={theme}>
    <Header />
    <main class={`mx-auto max-w-4xl w-full px-4 pb-8`}>
      <slot />
    </main>
    {import.meta.env.PROD && <PostHog />}
  </body>
</html>
